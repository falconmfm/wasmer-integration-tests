sinks:
  instance_logs_to_loki:
    endpoint: "http://loki:3100"
    inputs: ["instance_logs_cleaned"]
    type: "loki"
    encoding:
      codec: "json"
    healthcheck:
      enabled: false
    labels:
      app: "deploy-instances"
      app_id: "{{.app_id}}"
      app_version_id: "{{.app_version_id}}"
      env: "integration-test"
      ip: "127.0.0.1"
    batch:
      max_events: 1
  console:
    type: "console"
    inputs: ["instance_logs_cleaned"]
    encoding:
      codec: "raw_message"
sources:
  instance_logs:
    address: "0.0.0.0:9089"
    type: "http"
    decoding:
      codec: "native_json"
    framing:
      max_length: "1000"
      method: "newline_delimited"

transforms:
  instance_logs_cleaned:
    inputs: ["instance_logs"]
    source: |
      del(.path);
      del(.source_type);
    type: "remap"